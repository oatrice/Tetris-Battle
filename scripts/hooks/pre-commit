#!/bin/sh
# Pre-commit Hook for Tetris Battle

# TypeScript Client Directory
TS_DIR="client-nuxt"

# Check if directory exists relative to repo root
if [ -d "$TS_DIR" ]; then
    echo "üîç Checking TypeScript Client in $TS_DIR..."
    
    # Run in subshell
    (
        cd "$TS_DIR"
        
        # 1. Run Tests
        echo "üß™ Running Tests..."
        npm test
        TEST_RESULT=$?
        if [ $TEST_RESULT -ne 0 ]; then
             echo "‚ùå Tests Failed!"
             exit 1
        fi
        
        # 2. Run Build
        echo "üèóÔ∏è Running Build Check..."
        npm run build
        BUILD_RESULT=$?
        if [ $BUILD_RESULT -ne 0 ]; then
             echo "‚ùå Build Failed!"
             exit 1
        fi
    )
    
    # Capture exit code of subshell
    RESULT=$?
    
    if [ $RESULT -ne 0 ]; then
        echo "‚ùå Pre-commit checks failed! Commit rejected."
        exit 1
    else
        echo "‚úÖ All checks (Test & Build) passed!"
    fi
else
    echo "‚ö†Ô∏è Warning: $TS_DIR not found. Skipping checks."
fi

exit 0

#!/bin/sh
# Post-commit Hook for Tetris Battle

# TypeScript Client Directory
REPO_ROOT=$(git rev-parse --show-toplevel)
TS_DIR="$REPO_ROOT/client-nuxt"

if [ -d "$TS_DIR" ]; then
    echo "âœ… Commit Successful"
    
    COMMIT_DATE=$(git log -1 --format=%cI)
    echo "ğŸ“… Commit Timestamp: $COMMIT_DATE"
    
    # Kill any existing dev servers on common ports to prevent duplicates
    PIDS=$(lsof -t -i:3000 -i:3001 -i:3002)
    if [ -n "$PIDS" ]; then
        echo "ğŸ›‘ Killing existing dev servers (PIDs: $PIDS)..."
        echo "$PIDS" | xargs kill -9
        sleep 1
    fi

    echo "ğŸš€ Launching new Dev Server..."
    # Start new server in separate window (macOS)
    osascript -e "tell application \"Terminal\" to do script \"cd '$TS_DIR' && npm run dev\""
    
    echo "â„¹ï¸  Dev server started."
fi

exit 0

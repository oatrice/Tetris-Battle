#!/bin/sh
# Post-commit Hook for Tetris Battle

# TypeScript Client Directory
REPO_ROOT=$(git rev-parse --show-toplevel)
TS_DIR="$REPO_ROOT/client-ts"

if [ -d "$TS_DIR" ]; then
    echo "âœ… Commit Successful"
    
    # Check if vite is running
    # Grep for vite, exclude grep itself
    if pgrep -f "vite" > /dev/null; then
        echo "ğŸ”„ Existing Dev Server found. Triggering HMR/Restart..."
        
        # Touching vite.config.ts forces Vite to restart the server process
        # This will refresh the environment variables (like Version)
        touch "$TS_DIR/vite.config.ts"
        
        echo "âœ… Server restart triggered."
    else
        echo "ğŸš€ No Dev Server found. Launching new one..."
        
        # Start new server in separate window (macOS)
        osascript -e "tell application \"Terminal\" to do script \"cd '$TS_DIR' && npm run dev\""
        
        echo "â„¹ï¸  Dev server started."
    fi
fi

exit 0
